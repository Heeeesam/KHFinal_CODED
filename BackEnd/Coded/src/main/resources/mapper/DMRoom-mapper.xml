<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DMRoom">
	<select id="selectByUserNo" resultType="kh.coded.dto.DMRoomListDTO">
		 <![CDATA[
		select dm.roomid, m.userno, m.userid, m.usernickname, p.photoid, p.oriname, p.sysname
		from member m
		join dmroomuser dm on m.userno=dm.userno
		left join photo p on m.userno=p.userno
		where m.userno = any(select userno from dmroomuser where roomid = 
		any(select roomid from dmroomuser where userno = ${userNo}) 
		and userno <> ${userNo}) and dm.roomid = any(select roomid from dmroomuser where userno = ${userNo})
		]]>
	</select>
	
	<select id="createRoomId" resultType="int">
		select roomid_seq.nextval from dual
	</select>
</mapper>